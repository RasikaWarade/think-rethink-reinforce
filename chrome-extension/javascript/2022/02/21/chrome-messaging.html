<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Message Passing in Chrome Extension MV3 | Think Re-Think Reinforce</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Message Passing in Chrome Extension MV3" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Chrome Extension + Chrome Messaging + Promise &amp; Async Operations" />
<meta property="og:description" content="Chrome Extension + Chrome Messaging + Promise &amp; Async Operations" />
<link rel="canonical" href="https://rasikawarade.github.io/think-rethink-reinforce/chrome-extension/javascript/2022/02/21/chrome-messaging.html" />
<meta property="og:url" content="https://rasikawarade.github.io/think-rethink-reinforce/chrome-extension/javascript/2022/02/21/chrome-messaging.html" />
<meta property="og:site_name" content="Think Re-Think Reinforce" />
<meta property="og:image" content="https://rasikawarade.github.io/think-rethink-reinforce/images/chrome-messagin1.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-02-21T00:00:00-06:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://rasikawarade.github.io/think-rethink-reinforce/images/chrome-messagin1.png" />
<meta property="twitter:title" content="Message Passing in Chrome Extension MV3" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-21T00:00:00-06:00","datePublished":"2022-02-21T00:00:00-06:00","description":"Chrome Extension + Chrome Messaging + Promise &amp; Async Operations","headline":"Message Passing in Chrome Extension MV3","image":"https://rasikawarade.github.io/think-rethink-reinforce/images/chrome-messagin1.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://rasikawarade.github.io/think-rethink-reinforce/chrome-extension/javascript/2022/02/21/chrome-messaging.html"},"url":"https://rasikawarade.github.io/think-rethink-reinforce/chrome-extension/javascript/2022/02/21/chrome-messaging.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/think-rethink-reinforce/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://rasikawarade.github.io/think-rethink-reinforce/feed.xml" title="Think Re-Think Reinforce" /><link rel="shortcut icon" type="image/x-icon" href="/think-rethink-reinforce/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" /><script src="https://hypothes.is/embed.js" async></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/think-rethink-reinforce/">Think Re-Think Reinforce</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/think-rethink-reinforce/about/">About Me</a><a class="page-link" href="/think-rethink-reinforce/_pages/code_challenges.html">CodeChallenges</a><a class="page-link" href="/think-rethink-reinforce/search/">Search</a><a class="page-link" href="/think-rethink-reinforce/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Message Passing in Chrome Extension MV3</h1><p class="page-description">Chrome Extension + Chrome Messaging + Promise & Async Operations</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-02-21T00:00:00-06:00" itemprop="datePublished">
        Feb 21, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/think-rethink-reinforce/categories/#chrome-extension">chrome-extension</a>
        &nbsp;
      
        <a class="category-tags-link" href="/think-rethink-reinforce/categories/#javascript">javascript</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#between-background-and-popup-scripts">Between Background and Popup scripts</a></li>
<li class="toc-entry toc-h1"><a href="#between-background-and-content-scripts">Between Background and Content scripts</a></li>
<li class="toc-entry toc-h1"><a href="#between-popup-and-content-scripts">Between Popup and Content scripts</a></li>
<li class="toc-entry toc-h1"><a href="#some-gotchas">Some Gotchas!</a>
<ul>
<li class="toc-entry toc-h2"><a href="#sync-and-async-operations">Sync and Async Operations</a></li>
<li class="toc-entry toc-h2"><a href="#promises">Promises</a></li>
</ul>
</li>
</ul><p>A chrome extension is made up of multiple components, each with its own scope/functionality regarding what it can do in the browser. Example,</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Background script</code> : Listen to events happening in the extension, which covers all Chrome windows.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Popup script</code>: A web page that knows information about Chrome tabs.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Content script</code>: Read and modify the DOM of the current web page in the browser.</li>
</ul>

<p><img src="/think-rethink-reinforce/images/chrome-architecture.png" alt="" title="Fig. Message Passing - Chrome Extension">
Ref: <a href="https://developer.chrome.com/docs/extensions/mv3/architecture-overview/#arch">Chrome Extension Architecture</a></p>

<p>As each has its own scope, chrome extensions may or may not require information on each scope depending on the use case. Through chrome’s message passing, you can move information from one scope to another.</p>

<p>Here’s how each message looks consolidated.</p>

<ol>
  <li>You will need a listener:  <code class="language-plaintext highlighter-rouge">chrome.runtime.onMessage.addListener</code>
</li>
  <li>Depending on who is sending the message and to where, use :
    <ul>
      <li><code class="language-plaintext highlighter-rouge">chrome.tabs.sendMessage</code></li>
      <li><code class="language-plaintext highlighter-rouge">chrome.runtime.sendMessage</code></li>
    </ul>
  </li>
</ol>

<h1 id="between-background-and-popup-scripts">
<a class="anchor" href="#between-background-and-popup-scripts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Between Background and Popup scripts</h1>

<p><strong>Popup to Background</strong></p>

<p>popup.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Sending message
chrome.runtime.sendMessage({ message: 'user_signed_in', payload: confirmState },
    // callback response to the request
    function (response) {
        if (response.message === 'success' &amp;&amp; confirmState) {
            //user is signed in , do something
        }
    }
);
</code></pre></div></div>

<p>background.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Listening to Messages
chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
    if (request.message === 'user_signed_in') {
        // do something
        //callback reponse sent
        sendResponse({ message: 'success' });
    }
    return true;
});
</code></pre></div></div>

<p><strong>Background to Popup</strong></p>

<p>background.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chrome.runtime.sendMessage({
    msg: "something_completed", 
    data: {
        subject: "Loading",
        content: "Just completed!"
    }
});
</code></pre></div></div>

<p>popup.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chrome.runtime.onMessage.addListener(
    function(request, sender, sendResponse) {
        if (request.msg === "something_completed") {
            //  To do something
            console.log(request.data.subject)
            console.log(request.data.content)
        }
    }
);
</code></pre></div></div>
<p>Ref: <a href="https://stackoverflow.com/questions/12265403/passing-message-from-background-js-to-popup-js">Stackoverflow Link</a></p>

<h1 id="between-background-and-content-scripts">
<a class="anchor" href="#between-background-and-content-scripts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Between Background and Content scripts</h1>

<p><strong>Content to Background</strong></p>

<p>content.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chrome.runtime.sendMessage({greeting: "hello"}, function(response) {
  console.log(response.farewell);
});
</code></pre></div></div>

<p>background.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chrome.runtime.onMessage.addListener(
  function(request, sender, sendResponse) {
    console.log(sender.tab ?
                "from a content script:" + sender.tab.url :
                "from the extension");
    if (request.greeting === "hello")
      sendResponse({farewell: "goodbye"});
  }
);
</code></pre></div></div>
<p>Ref: <a href="https://developer.chrome.com/docs/extensions/mv3/messaging/#simple">Chrome Message Passing</a></p>

<p><strong>Background to Content</strong></p>

<p>background.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chrome.tabs.query({active: true, currentWindow: true}, function(tabs){
    const activeTab= tabs[0]
    //Sending message to active Tab
    chrome.tabs.sendMessage(activeTab.id, { message: "start" },
        //callback response
        function (response) {
            if (response.message === 'success') {
                console.log("success!!")
            }
        }
    );
};

</code></pre></div></div>

<p>content.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Listening to Messages
chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
        if (request.message === 'start') {
            //callback response to request
            sendResponse({ message : 'success' });
        }
        return true;
});
</code></pre></div></div>

<h1 id="between-popup-and-content-scripts">
<a class="anchor" href="#between-popup-and-content-scripts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Between Popup and Content scripts</h1>

<p><strong>Popup to Content</strong></p>

<p>popup.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chrome.tabs.query({active: true, currentWindow: true}, function(tabs){
    let activeTab = tabs[0];
    //Sending message to active Tab
    chrome.tabs.sendMessage(activeTab.id,{ message: 'get_details' },
        //callback
        function (response) {
            if (response.message === 'success') {
                console.log("success!!")
            }
        });
})
</code></pre></div></div>

<p>content.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Listening to Messages
chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
        if (request.message === 'get_details') {
            //callback response to request
            sendResponse({ message : 'success' });
        }
        return true;
});
</code></pre></div></div>

<p><strong>Content to Popup</strong></p>

<p>content.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chrome.runtime.sendMessage({greeting: "hello"}, function(response) {
  console.log(response.farewell);
});
</code></pre></div></div>

<p>popup.js</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chrome.runtime.onMessage.addListener(
  function(request, sender, sendResponse) {
    console.log(sender.tab ?
                "from a content script:" + sender.tab.url :
                "from the extension");
    if (request.greeting === "hello")
      sendResponse({farewell: "goodbye"});
  }
);
</code></pre></div></div>
<p>Ref: <a href="https://developer.chrome.com/docs/extensions/mv3/messaging/#simple">Chrome Message Passing</a></p>

<h1 id="some-gotchas">
<a class="anchor" href="#some-gotchas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Some Gotchas!</h1>

<h2 id="sync-and-async-operations">
<a class="anchor" href="#sync-and-async-operations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sync and Async Operations</h2>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">sendResponse</code> in the <strong>Content to Popup</strong> implementation is behaving synchronous.</li>
  <li>To use <code class="language-plaintext highlighter-rouge">sendReponse</code> asynchronously, use <code class="language-plaintext highlighter-rouge">return true;</code> as in the <strong>Popup to Content</strong> implementation.</li>
</ul>

<h2 id="promises">
<a class="anchor" href="#promises" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promises</h2>

<p>If you are waiting on some callback function result which is asynchronous, you can wrap the operation in a promise.</p>

<p>Example, waiting on the getting active tab  information from <code class="language-plaintext highlighter-rouge">chrome.tabs</code>, to send the message from <strong>background to content</strong>. Without a promise, the message response may not be captured by background. Make the changes like below:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Follow Promise style
function getActiveTab() {
    return new Promise((resolve, reject) =&gt; {
        try {
            chrome.tabs.query({
                active: true,
                currentWindow: true
            }, function (tabs) {
                resolve(tabs[0]);
            });
        } catch (e) {
            reject(e);
        }
    })
}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let activeTabPromise = getActiveTab()
Promise.all([activeTabPromise])
    .then(result =&gt; {
        const activeTab = result[0]
        //Sending message to active Tab
        chrome.tabs.sendMessage(activeTab.id, { message: "start" },
            //callback response
            function (response) {
                if (response.message === 'success') {
                    console.log("success!!")
                }
            }
        );
    });
</code></pre></div></div>

  </div><a class="u-url" href="/think-rethink-reinforce/chrome-extension/javascript/2022/02/21/chrome-messaging.html" hidden></a>
</article>

      </div>
    </main><style type="text/css">
  .div-content {
    background-color: #fff;
  }
</style>
<div class="div-content">
  <!-- <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28"
    preserveAspectRatio="none" shape-rendering="auto">
    <defs>
      <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
    </defs>
    <g class="parallax">
      <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7)" />
      <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
      <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
      <use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
    </g>
  </svg> -->
</div>
<footer class="site-footer h-card">
  <data class="u-url" href="/think-rethink-reinforce/%20/"></data>
  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col">
        <!-- <p class="feed-subscribe">
          <a href="/think-rethink-reinforce/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/think-rethink-reinforce/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p> -->
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>
    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/RasikaWarade" target="_blank" title="RasikaWarade"><svg class="svg-icon grey"><use xlink:href="/think-rethink-reinforce/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/rasikawarade" target="_blank" title="rasikawarade"><svg class="svg-icon grey"><use xlink:href="/think-rethink-reinforce/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/Rasika5W" target="_blank" title="Rasika5W"><svg class="svg-icon grey"><use xlink:href="/think-rethink-reinforce/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>
  </div>

</footer></body>

</html>
